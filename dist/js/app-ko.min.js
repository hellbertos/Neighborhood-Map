
window.onload=function(){var eyeIcon="img/icon-eye.png";var dineIcon="img/icon-dine.png";var surfIcon="img/icon-surf.png";var drinkIcon="img/icon-drink.png";var localCoords=[{title:'Sutro Baths',latLng:{lat:37.780109,lng:-122.513965},icon:eyeIcon,animation:null,fsid:'4a05e6dbf964a52098721fe3',zip:'94121',description:'The ruins of the former salt water fed bath house from the turn of the former century. Great visitors center and lots of hiking trails make it a must do!'},{title:'Wise Surfboards',latLng:{lat:37.772765,lng:-122.510714},icon:surfIcon,animation:null,fsid:'4a6d0b27f964a52065d21fe3',zip:'94121',description:'The oldest surviving surf shop in the city with views of the first peaks regularly surfed in San Francisco. They carry many of the top brands of boards and wetsuits.'},{title:'The Beach Chalet',latLng:{lat:37.769517,lng:-122.510263},icon:dineIcon,animation:null,fsid:'43cc06a3f964a520c72d1fe3',zip:'94121',description:'Come for the great sunsets, stay for the tasty craft beers. Incredible views of the Pacific Ocean, a fantastic menu as well as well as beers brewed in-house. Great after a day at the beach.'},{title:'Ocean Beach',latLng:{lat:37.765166,lng:-122.512592},icon:eyeIcon,animation:null,fsid:'409ad180f964a520eef21ee3',zip:'94122',description:'Part of the Federal Parks Service, Ocean Beach is an awesome, natural experience of beach and ocean. Bonfires are allowed in the rings provided.'},{title:'Aqua Surf Shop',latLng:{lat:37.760314,lng:-122.503595},icon:surfIcon,animation:null,fsid:'4ad0f5e0f964a52084db20e3',zip:'94122',description:'Locally owned and operated. Staffed with experts to help you make the right purchase. Aqua also runs the only surfboard rental service in the area.'},{title:'La Playa Taqueria',latLng:{lat:37.752834,lng:-122.504720},icon:dineIcon,animation:null,fsid:'4a664abcf964a52056c81fe3',zip:'94116',description:'Argueably the best breakfast burritos in the fogbelt. An extensive menu of traditional Mexican food from dinner plates to venerable burritos',},{title:'The Rip Tide Lounge',latLng:{lat:37.741580,lng:-122.505349},icon:drinkIcon,animation:null,fsid:'4d3c6a863ec9a35dfd644881',zip:'94116',description:'The local place to grab a cold drink after a day Ocean Beach. Live music, great beers on tap, drink specials and a fire place to warm up next to!'},{title:'San Francisco Zoo',latLng:{lat:37.733201,lng:-122.502764},icon:eyeIcon,animation:null,fsid:'49ca9423f964a520c0581fe3',zip:'94132',description:'The San Francisco Zoo is a world renowned exibit of live animals, conservation effort and research facility.'}];var fourSqrCall=function(passedTitle){var placeFsId=null;for(var s=0,len=localCoords.length;s<len;s++){if(localCoords[s].title===passedTitle){placeFsId=localCoords[s].fsid;}}
var fsRequest='https://api.foursquare.com/v2/venues/'+placeFsId+'?client_id=TPXYNVAKFZ3ZO55KQBFIUEBKQWHSGFL3EPG10VS0SAZZ2O51&client_secret=AY30L1ITLWN3A0MVJHZBICG1WTX1FFQFGB52EIEYIRDNBQEU&v=20130815&limit=3';$.ajax({url:fsRequest,data:{format:'json'},error:function(jqXHR,testStatus,errorThrown){var stringToSend='<div>Sorry, we do not have a picture for this location.</div>';$('#fsHere').append(stringToSend);},success:function(data){var delimiter=data.response.venue.photos.groups[0].items.length;var randomnumber=Math.floor(Math.random()*(delimiter-1));var stringToSend='<div><img src="'+data.response.venue.photos.groups[0].items[randomnumber].prefix+"150x150"+data.response.venue.photos.groups[0].items[randomnumber].suffix+'"></div>';$('#fs-here').append(stringToSend);}});};var yelpCall=function(passedTitle){var zip;for(var t=0,len=localCoords.length;t<len;t++){if(localCoords[t].title===passedTitle){zip=localCoords[t].zip;}}
var searchOn='food';var auth={consumerKey:"JXePW9urpn9rtM0EbzaZmg",consumerSecret:"tAaubaecdRrxjVjlUcnVH1QQWdo",accessToken:"ehhl-T6l4g5QarL6BP6WxhN4PTu3mCqH",accessTokenSecret:"nRFrxQ5KM1i7LfUMFVC4VHq6JZc",serviceProvider:{signatureMethod:"HMAC-SHA1"}};var terms=searchOn;var near=zip;var accessor={consumerSecret:auth.consumerSecret,tokenSecret:auth.accessTokenSecret};parameters=[];parameters.push(['term',terms]);parameters.push(['location',near]);parameters.push(['callback','cb']);parameters.push(['oauth_consumer_key',auth.consumerKey]);parameters.push(['oauth_token',auth.accessToken]);var message={'action':'http://api.yelp.com/v2/search','method':'GET','parameters':parameters};OAuth.setTimestampAndNonce(message);OAuth.SignatureMethod.sign(message,accessor);var parameterMap=OAuth.getParameterMap(message.parameters);var yelpRequestTimeout=setTimeout(function(){$('#yelpHere').append('Sorry, Yelp is not responding right now. Please try again later');},9000);$.ajax({'url':message.action,'data':parameterMap,'dataType':'jsonp','jsonpCallback':'cb','cache':true,'success':function(data,textStats,XMLHttpRequest){var delimiter=data.businesses.length;var randomBiz=Math.floor(Math.random()*(delimiter-1));if(data){var stringToSend='<h3>Dining Suggestion:</h3><div><strong>'+data.businesses[randomBiz].name+'</strong><ul><li>Yelp Rating: '+data.businesses[randomBiz].rating+'</li><li>Phone: '+data.businesses[randomBiz].display_phone+'</li><li>Address: '+data.businesses[randomBiz].location.address[0]+'</li><ul>';$('#yelpHere').append(stringToSend);}
clearTimeout(yelpRequestTimeout);}});};var Marker=function(latLng,title,icon,description,map){return new google.maps.Marker({position:latLng,map:map,icon:icon,title:title,description:description});};var ViewModel=function(){var modelCxt=this;modelCxt.placeList=ko.observableArray();modelCxt.drawerVisible=ko.observable(false);var screenWidth=screen.width;var sidebar=document.getElementById('nav-bar');if(screenWidth>768){sidebar.style.transform="translateX(200px)";modelCxt.drawerVisible(true);}
var mapCanvas=document.getElementById('map');var mapOptions={center:new google.maps.LatLng(37.760191,-122.512345),zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP};modelCxt.map=new google.maps.Map(mapCanvas,mapOptions);modelCxt.infoWindow=new google.maps.InfoWindow({maxWidth:280});for(var i=0,len=localCoords.length;i<len;i++){locale=localCoords[i];var marker=(new Marker(locale.latLng,locale.title,locale.icon,locale.description,modelCxt.map));marker.show=ko.observable(true);modelCxt.placeList.push(marker);(function(marker){google.maps.event.addListener(marker,'click',function(){modelCxt.selectMarker(marker);});})(marker);}
modelCxt.selectMarker=function(marker){marker.setAnimation(google.maps.Animation.BOUNCE);setTimeout(function(){marker.setAnimation(null);},2150);var placeContent='<div id="info-win-interior"><h1 class="info-win-title">'+marker.title+'</h1><div id="fs-container"><div id="fs-here"></div>'+marker.description+'</div><div id="yelpHere"></div></div>';modelCxt.infoWindow.setContent(placeContent);modelCxt.infoWindow.open(marker.get('map'),marker);fourSqrCall(marker.title);yelpCall(marker.title);modelCxt.map.panTo(marker.getPosition());modelCxt.map.panBy(20,-200);if(screenWidth<=768){sidebar.style.transform="translateX(0)";modelCxt.drawerVisible(false);}};modelCxt.searchString=ko.observable();modelCxt.searchIt=function(marker){var query=modelCxt.searchString().toLowerCase();var theTest=function(list){var testTitle=list.title.toLowerCase();if(testTitle.indexOf(query)>=0){list.setVisible(true);list.show(true);}else{list.setVisible(false);list.show(false);modelCxt.infoWindow.close(list.get('map'),list);}};modelCxt.placeList().filter(theTest);};modelCxt.toggleDrawer=function(){if(modelCxt.drawerVisible()===true){sidebar.style.transform="translateX(0)";modelCxt.drawerVisible(false);}else{sidebar.style.transform="translateX(200px)";modelCxt.drawerVisible(true);}};};ko.applyBindings(new ViewModel());};